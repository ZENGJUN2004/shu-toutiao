<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>上大头条 | 实时舆情聚合</title>
    <style>
        /* --- 基础样式 --- */
        :root { --primary: #d32f2f; --bg: #f7f8fa; --card-bg: #fff; --text: #333; --meta: #999; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }
        
        /* 容器 */
        .container { max-width: 600px; margin: 0 auto; min-height: 100vh; background: var(--bg); display: flex; flex-direction: column; }

        /* 顶部导航 */
        .header { background: var(--primary); color: #fff; padding: 15px; position: sticky; top: 0; z-index: 999; box-shadow: 0 2px 8px rgba(211, 47, 47, 0.3); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; letter-spacing: 1px; }
        .update-badge { font-size: 0.75rem; background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 12px; }

        /* 提示条 */
        .notice { background: #e3f2fd; color: #1565c0; font-size: 0.8rem; padding: 10px 15px; display: flex; align-items: center; gap: 8px; }
        .notice::before { content: "ℹ️"; }

        /* 新闻列表 */
        .feed { padding: 10px; flex: 1; }
        
        /* 卡片设计 */
        .card { background: var(--card-bg); border-radius: 8px; padding: 16px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); text-decoration: none; display: block; color: inherit; transition: transform 0.1s; border-left: 3px solid transparent; }
        .card:active { background: #fafafa; transform: scale(0.99); }
        
        .card-title { font-size: 1.05rem; line-height: 1.5; font-weight: 500; margin-bottom: 8px; color: #222; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .card-meta { display: flex; align-items: center; font-size: 0.75rem; color: var(--meta); gap: 8px; }
        
        /* 标签颜色系统 */
        .tag { padding: 1px 6px; border-radius: 4px; font-weight: 500; font-size: 0.7rem; }
        /* 官网 - 红色 */
        .tag.official { color: #d32f2f; background: #ffebee; border: 1px solid #ffcdd2; }
        /* 媒体 - 蓝色 */
        .tag.media { color: #1976d2; background: #e3f2fd; border: 1px solid #bbdefb; }
        /* 视频 - 橙色 */
        .tag.video { color: #f57c00; background: #fff3e0; border: 1px solid #ffe0b2; }
        /* 论坛 - 绿色 */
        .tag.forum { color: #388e3c; background: #e8f5e9; border: 1px solid #c8e6c9; }

        /* 底部 */
        .footer { text-align: center; padding: 30px; color: #ccc; font-size: 0.75rem; }
        
        /* 加载与空状态 */
        .status-msg { text-align: center; padding: 40px; color: #999; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <header class="header">
        <h1>上大头条</h1>
        <div class="update-badge" id="update-time">更新中...</div>
    </header>

    <div class="notice">
        聚合全网资讯，每小时自动更新
    </div>

    <div class="feed" id="news-feed">
        <div class="status-msg">正在连接云端数据...</div>
    </div>

    <div class="footer">
        Powered by SHU Digital Humanities Lab
    </div>
</div>

<script>
    // 1. 创建动态脚本加载器
    var script = document.createElement('script');
    // 加上时间戳，保证每次都从服务器拿最新的，绝不读缓存
    script.src = 'data.js?v=' + new Date().getTime();
    
    // 2. 关键点：定义“加载完成后做什么”
    script.onload = function() {
        console.log("数据文件加载成功！");
        
        // 只有在这里（文件回来后），才能去读 SHU_DATA
        if (typeof window.SHU_DATA === 'undefined' || !window.SHU_DATA.news) {
            // 如果文件加载了，但变量还是空的，说明文件内容坏了
            document.getElementById('news-feed').innerHTML = '<div class="loading">⚠️ 数据加载异常<br>请检查 data.js 格式</div>';
        } else {
            // 数据一切正常，开始渲染！
            var allData = window.SHU_DATA.news;
            
            // 更新顶部时间
            var timeInfo = document.getElementById('update-info');
            if(timeInfo) {
                // 如果后端有时差，这里只取日期部分，或者直接显示
                timeInfo.textContent = "更新时间: " + (window.SHU_DATA.update_time || "刚刚");
            }
            
            // 渲染列表
            render(allData);
        }
    };

    // 3. 处理加载失败的情况（比如网络断了）
    script.onerror = function() {
        document.getElementById('news-feed').innerHTML = '<div class="loading">❌ 网络连接失败<br>无法读取 data.js</div>';
    };

    // 4. 最后才把脚本插到页面里，开始下载
    document.body.appendChild(script);

    // --- 渲染函数保持不变 ---
    function render(data) {
        const feed = document.getElementById('news-feed');
        feed.innerHTML = ''; // 清空载入动画

        if (!data || data.length === 0) {
            feed.innerHTML = '<div class="loading">暂无数据</div>';
            return;
        }

        data.forEach(item => {
            // 简单防错
            if(!item.title) return;

            const el = document.createElement('a');
            el.className = 'card';
            el.href = item.url || '#';
            el.target = "_blank";
            
            // 根据 tag 决定颜色（兼容新旧版本）
            let tagClass = 'tag-other';
            let tagName = '资讯';
            
            if(item.tag === 'official') { tagClass = 'tag-meeting'; tagName = '官网'; }
            else if(item.tag === 'media') { tagClass = 'tag-activity'; tagName = '媒体'; }
            else if(item.tag === 'video') { tagClass = 'tag-voice'; tagName = '视频'; }
            else if(item.tag === 'forum') { tagClass = 'tag-voice'; tagName = '讨论'; }
            else if(item.category) { 
                // 兼容文学动态的分类
                tagName = {'meeting':'会议','voice':'声音','activity':'活动'}[item.category] || '动态';
                tagClass = 'tag-' + item.category;
            }

            el.innerHTML = `
                <div class="card-title">${item.title}</div>
                <div class="card-info">
                    <span><span class="tag ${tagClass}">${tagName}</span>${item.source || '网络'}</span>
                    <span>${item.time || '近期'}</span>
                </div>
            `;
            feed.appendChild(el);
        });
    }
</script>

</body>

</html>

